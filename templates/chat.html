<!DOCTYPE html>
<html>
<head>
    <title>Starlette Simple Chat</title>
    <style>
        body { font-family: Arial, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; background-color: #f4f4f9; }
        .chat-container { width: 400px; height: 600px; border: 1px solid #ccc; border-radius: 8px; display: flex; flex-direction: column; background: white; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .chat-messages { flex-grow: 1; padding: 10px; overflow-y: auto; background-color: #e9e9e9; }
        .message { margin-bottom: 10px; padding: 8px; border-radius: 5px; max-width: 80%; }
        .user-message { background-color: #dcf8c6; align-self: flex-end; margin-left: auto; text-align: right;}
        .bot-message { background-color: #ffffff; align-self: flex-start; text-align: left; border: 1px solid #ddd; }
        .chat-input { display: flex; padding: 10px; border-top: 1px solid #ccc; }
        .chat-input input { flex-grow: 1; padding: 10px; border: 1px solid #ddd; border-radius: 20px; margin-right: 10px; }
        .chat-input button { padding: 10px 15px; border: none; background-color: #007bff; color: white; border-radius: 20px; cursor: pointer; }
        .chat-input button:hover { background-color: #0056b3; }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-messages" id="messages">
            <div class="message bot-message">Welcome! Ask me about Starlette or say hello!</div>
        </div>
        <div class="chat-input">
            <input type="text" id="user-input" placeholder="Type your message...">
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        // Function to display a message
        function displayMessage(text, sender) {
            const messagesDiv = document.getElementById('messages');
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', sender === 'user' ? 'user-message' : 'bot-message');
            messageElement.textContent = text;
            messagesDiv.appendChild(messageElement);
            messagesDiv.scrollTop = messagesDiv.scrollHeight; // Scroll to bottom
        }

        // Function to send a message to the /chat API
        async function sendMessage() {
            const inputElement = document.getElementById('user-input');
            const userMessage = inputElement.value.trim();

            if (userMessage === '') return;

            // 1. Display user message immediately
            displayMessage(userMessage, 'user');
            inputElement.value = ''; // Clear input

            try {
                // 2. Call the /chat API
                const response = await fetch('/rag_chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message: userMessage })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                const botResponse = data.response;
                
                // 3. Display bot response
                displayMessage(botResponse, 'bot');

            } catch (error) {
                console.error('Error during chat API call:', error);
                displayMessage('Error: Could not connect to the LLM service.', 'bot');
            }
        }
        
        // Allow sending message with Enter key
        document.getElementById('user-input').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>